{"version":3,"file":"WorkerDetailView.js","sources":["../../src/api/worker.ts","../../src/views/WorkerDetailView.vue"],"sourcesContent":["/**\n * 电影人相关 API 接口\n */\nimport request from './request'\n\n/** 获取电影人详情 */\nexport const fetchWorkerDetail = (workerId: number | string) =>\n    request.get(`/workers/${workerId}`)\n","<script setup lang=\"ts\">\nimport { ref, computed, onMounted, watch } from 'vue'\nimport { useRoute, useRouter } from 'vue-router'\nimport { fetchWorkerDetail } from '@/api/worker'\nimport { fetchMovieList } from '@/api/movie'\nimport { hashColor, formatDate, getInitial } from '@/utils/parse'\nimport Breadcrumb from '@/components/Breadcrumb.vue'\nimport MovieCard from '@/components/MovieCard.vue'\n\nconst route = useRoute()\nconst router = useRouter()\n\nconst worker = ref<any>(null)\nconst loading = ref(true)\nconst notFound = ref(false)\n\n// 相关作品\nconst relatedMovies = ref<any[]>([])\nconst relatedLoading = ref(false)\n\n// 职业标签\nconst professions = computed(() => {\n  if (!worker.value?.profession) return []\n  return worker.value.profession.split('/').map((p: string) => p.trim()).filter(Boolean)\n})\n\n// 头像颜色\nconst avatarColor = computed(() => hashColor(worker.value?.workerId || 0))\n\n// 名字首字\nconst initial = computed(() => getInitial(worker.value?.nameZh || worker.value?.nameEn || ''))\n\n// 面包屑 — 根据来源页面动态构建\nconst breadcrumbs = computed(() => {\n  const from = router.options.history.state?.back as string\n  const items: { label: string; to?: string }[] = [{ label: '首页', to: '/' }]\n  // 如果从电影详情来\n  if (from && from.startsWith('/movies/')) {\n    items.push({ label: '电影列表', to: '/movies' })\n    items.push({ label: '电影详情', to: from })\n  }\n  items.push({ label: worker.value?.nameZh || '电影人' })\n  return items\n})\n\n// 加载\nconst loadWorker = async () => {\n  loading.value = true\n  notFound.value = false\n  try {\n    const res: any = await fetchWorkerDetail(route.params.workerId as string)\n    worker.value = res?.data || res\n    loadRelatedMovies()\n  } catch (e: any) {\n    if (e?.code === 404) {\n      notFound.value = true\n    } else {\n      console.error('加载电影人详情失败', e)\n    }\n  } finally {\n    loading.value = false\n  }\n}\n\nconst loadRelatedMovies = async () => {\n  if (!worker.value) return\n  relatedLoading.value = true\n  try {\n    const keyword = worker.value.nameZh || worker.value.workerName || ''\n    if (!keyword) return\n    const res: any = await fetchMovieList({\n      keyword,\n      pageNum: 1,\n      pageSize: 8,\n      sortField: 'douban_score',\n      sortOrder: 'desc'\n    })\n    // PageResult 格式：total/data 在顶层\n    relatedMovies.value = res?.data || []\n  } catch (e) {\n    console.error('加载相关作品失败', e)\n  } finally {\n    relatedLoading.value = false\n  }\n}\n\nconst goToAllMovies = () => {\n  const keyword = worker.value?.nameZh || worker.value?.workerName || ''\n  router.push({ path: '/movies', query: { keyword } })\n}\n\nonMounted(loadWorker)\n\nwatch(() => route.params.workerId, () => {\n  loadWorker()\n})\n</script>\n\n<template>\n  <Breadcrumb :items=\"breadcrumbs\" />\n\n  <!-- 加载中 -->\n  <div v-if=\"loading\" class=\"detail-loading\">\n    <div class=\"spinner\"></div>\n  </div>\n\n  <!-- 404 -->\n  <div v-else-if=\"notFound\" class=\"detail-not-found\">\n    <h2>电影人不存在</h2>\n    <p>该电影人可能已被删除或 ID 无效</p>\n    <button class=\"btn-primary\" @click=\"router.push('/movies')\">返回电影列表</button>\n  </div>\n\n  <!-- 电影人详情 -->\n  <div v-else-if=\"worker\" class=\"worker-detail-page page-container\">\n    <!-- Hero 区 -->\n    <section class=\"worker-hero\">\n      <div class=\"worker-avatar\" :style=\"{ background: avatarColor }\">\n        {{ initial }}\n      </div>\n      <div class=\"worker-info\">\n        <h1 class=\"worker-name-zh\">{{ worker.nameZh }}</h1>\n        <p v-if=\"worker.nameEn\" class=\"worker-name-en\">{{ worker.nameEn }}</p>\n\n        <!-- 职业标签 -->\n        <div v-if=\"professions.length\" class=\"worker-professions\">\n          <span v-for=\"p in professions\" :key=\"p\" class=\"tag-capsule\">{{ p }}</span>\n        </div>\n\n        <!-- 信息列表 -->\n        <div class=\"info-list\">\n          <div class=\"info-row\" v-if=\"worker.gender\">\n            <span class=\"info-label\">性别</span>\n            <span class=\"info-value\">{{ worker.gender }}</span>\n          </div>\n          <div class=\"info-row\" v-if=\"worker.constellatory\">\n            <span class=\"info-label\">星座</span>\n            <span class=\"info-value\">{{ worker.constellatory }}</span>\n          </div>\n          <div class=\"info-row\" v-if=\"worker.birth\">\n            <span class=\"info-label\">出生日期</span>\n            <span class=\"info-value\">{{ formatDate(worker.birth) }}</span>\n          </div>\n          <div class=\"info-row\" v-if=\"worker.birthplace\">\n            <span class=\"info-label\">出生地</span>\n            <span class=\"info-value\">{{ worker.birthplace }}</span>\n          </div>\n        </div>\n      </div>\n    </section>\n\n    <!-- 人物简介 -->\n    <section class=\"content-section\">\n      <h2 class=\"section-title\">人物简介</h2>\n      <p v-if=\"worker.biography\" class=\"bio-text\">{{ worker.biography }}</p>\n      <p v-else class=\"bio-empty\">暂无简介</p>\n    </section>\n\n    <!-- 相关作品 -->\n    <section class=\"content-section\">\n      <div class=\"related-header\">\n        <h2 class=\"section-title\">相关作品</h2>\n        <button v-if=\"relatedMovies.length > 0\" class=\"btn-outline btn-sm\" @click=\"goToAllMovies\">\n          查看全部 →\n        </button>\n      </div>\n\n      <div v-if=\"relatedLoading\" class=\"related-loading\">\n        <div class=\"spinner\"></div>\n      </div>\n\n      <div v-else-if=\"relatedMovies.length > 0\" class=\"related-grid\">\n        <MovieCard v-for=\"movie in relatedMovies\" :key=\"movie.movieId\" :movie=\"movie\" />\n      </div>\n\n      <p v-else class=\"bio-empty\">暂无相关作品</p>\n    </section>\n  </div>\n</template>\n\n<style scoped>\n.detail-loading,\n.detail-not-found {\n  min-height: 60vh;\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  justify-content: center;\n  gap: 16px;\n  text-align: center;\n  padding: 24px;\n}\n\n.spinner {\n  width: 36px;\n  height: 36px;\n  border: 3px solid var(--color-border);\n  border-top-color: var(--color-primary);\n  border-radius: 50%;\n  animation: spin 0.8s linear infinite;\n}\n\n@keyframes spin {\n  to { transform: rotate(360deg); }\n}\n\n.detail-not-found h2 { font-size: 22px; }\n.detail-not-found p { color: var(--color-text-muted); margin-bottom: 12px; }\n\n.worker-detail-page {\n  padding-top: 32px;\n  padding-bottom: 60px;\n}\n\n/* Hero */\n.worker-hero {\n  display: flex;\n  gap: 32px;\n  align-items: flex-start;\n  margin-bottom: 40px;\n}\n\n.worker-avatar {\n  flex-shrink: 0;\n  width: 140px;\n  height: 140px;\n  border-radius: 50%;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  font-size: 56px;\n  font-weight: 700;\n  color: #fff;\n  box-shadow: 0 8px 24px rgba(0, 0, 0, 0.3);\n}\n\n.worker-info {\n  flex: 1;\n  min-width: 0;\n}\n\n.worker-name-zh {\n  font-size: 32px;\n  font-weight: 700;\n  margin-bottom: 4px;\n}\n\n.worker-name-en {\n  font-size: 16px;\n  color: var(--color-text-muted);\n  margin-bottom: 14px;\n}\n\n.worker-professions {\n  display: flex;\n  flex-wrap: wrap;\n  gap: 6px;\n  margin-bottom: 16px;\n}\n\n.info-list {\n  margin-top: 8px;\n}\n\n.info-row {\n  display: flex;\n  gap: 12px;\n  padding: 5px 0;\n  font-size: 14px;\n}\n\n.info-label {\n  flex-shrink: 0;\n  width: 64px;\n  color: var(--color-text-muted);\n  text-align: right;\n}\n\n.info-value {\n  flex: 1;\n}\n\n/* 简介 */\n.content-section {\n  margin-bottom: 36px;\n}\n\n.bio-text {\n  font-size: 15px;\n  line-height: 1.8;\n  white-space: pre-wrap;\n}\n\n.bio-empty {\n  font-size: 14px;\n  color: var(--color-text-muted);\n  font-style: italic;\n}\n\n/* 相关作品 */\n.related-header {\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  margin-bottom: 8px;\n}\n\n.related-header .section-title {\n  margin-bottom: 0;\n}\n\n.btn-sm {\n  padding: 6px 16px;\n  font-size: 13px;\n}\n\n.related-loading {\n  padding: 40px;\n  display: flex;\n  justify-content: center;\n}\n\n.related-grid {\n  display: grid;\n  grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));\n  gap: 20px;\n}\n\n/* 响应式 */\n@media (max-width: 640px) {\n  .worker-hero {\n    flex-direction: column;\n    align-items: center;\n    text-align: center;\n  }\n  .worker-avatar {\n    width: 100px;\n    height: 100px;\n    font-size: 40px;\n  }\n  .worker-name-zh {\n    font-size: 24px;\n  }\n  .info-row {\n    flex-direction: column;\n    gap: 2px;\n  }\n  .info-label {\n    width: auto;\n    text-align: center;\n  }\n  .worker-professions {\n    justify-content: center;\n  }\n  .related-grid {\n    grid-template-columns: repeat(auto-fill, minmax(130px, 1fr));\n    gap: 12px;\n  }\n}\n</style>\n"],"names":["_createVNode","_openBlock","_createElementBlock","_createElementVNode","_unref","_toDisplayString","_Fragment","_renderList","_createBlock"],"mappings":"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"}